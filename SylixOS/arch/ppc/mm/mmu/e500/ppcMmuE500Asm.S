;/*********************************************************************************************************
;**
;**                                    中国软件开源组织
;**
;**                                   嵌入式实时操作系统
;**
;**                                       SylixOS(TM)
;**
;**                               Copyright  All Rights Reserved
;**
;**--------------文件信息--------------------------------------------------------------------------------
;**
;** 文   件   名: ppcMmuE500Asm.S
;**
;** 创   建   人: Jiao.JinXing (焦进星)
;**
;** 文件创建日期: 2016 年 05 月 04 日
;**
;** 描        述: PowerPC E500 体系构架 MMU 驱动.
;*********************************************************************************************************/

#ifndef ASSEMBLY
#define ASSEMBLY 1
#endif

#include <arch/assembler.h>
#include <config/kernel/vmm_cfg.h>

#if LW_CFG_VMM_EN > 0

#include "arch/ppc/arch_e500.h"

    FILE_BEGIN()

    EXPORT_LABEL(ppcE500MmuInvalidateTLB)
    EXPORT_LABEL(ppcE500MmuInvalidateTLBEA)

;/*********************************************************************************************************
;  定义
;*********************************************************************************************************/

#define INV_TLB0    0x0

;/*********************************************************************************************************
;  无效所有 TLB
;*********************************************************************************************************/

FUNC_DEF(ppcE500MmuInvalidateTLB)
    LIS         R3 , HIADJ(ARCH_PPC_MMUCSR0_L2TLB0_FI)
    ADDI        R3 , R3 , LO(ARCH_PPC_MMUCSR0_L2TLB0_FI)
    ISYNC
    MTSPR       MMUCSR0 , R3
    ISYNC
    TLBSYNC
    ISYNC
    BLR
    FUNC_END()

;/*********************************************************************************************************
;  无效指定 EA 的 TLB
;*********************************************************************************************************/

FUNC_DEF(ppcE500MmuInvalidateTLBEA)
    ORI         R3 , R3 , INV_TLB0
    ISYNC
    TLBIVAX     R0 , R3
    ISYNC
    MSYNC
    TLBSYNC
    ISYNC
    BLR
    FUNC_END()

    FILE_END()
#endif
;/*********************************************************************************************************
;  END
;*********************************************************************************************************/
